var poncho_json = {
    // Home
    home_swiper: "",

    // Meme generator
    meme_canvas: ""
}

    
// On document ready
$(function () {
    try {
        // Initialize app
        initialize_app();
    } catch (e) {
        // console.log(e);
    }
});

function initialize_app() {
    try {
        // Primary
        // Init accordions
        init_accordions();

        // Init anchor tags
        init_anchor_tags();

        // Init charts
        init_charts();

        // Init lazy load
        init_lazy_load();

        // Init modals
        init_modals();

        // Init particles
        init_particles();

        // Init popstate
        init_popstate();

        // Init scroll
        init_scroll();

        // Init swipers
        init_swipers();

        // Read token
        read_token(true);

        // Set read token interval
        set_read_token_interval();

        // Secondary
        // Init meme generator
        init_meme_generator();
    } catch (e) {
        // console.error(e);
    }
}
function check_array_defined(array) {
    try {
        // Check if
        if (typeof array == "undefined" || array == null || !$.isArray(array)) {
            // Vars
            array = [];
        }
    } catch (e) {
        // console.error(e);
        array = [];
    }

    // Return
    return array;
}

function check_value_defined(value) {
    try {
        // Check if
        if (typeof value == "undefined" || value == null) {
            // Vars
            value = "";
        }
    } catch (e) {
        // console.error(e);
        // Vars
        value = "";
    }

    // Return
    return value;
}

function copy_to_clipboard(e, selector) {
    try {
        // Vars
        var selector_parent = $(e.currentTarget).closest(selector);

        // Copy to clipboard
        navigator.clipboard.writeText(e.currentTarget.value);

        // Add class
        $(selector_parent).addClass("copied");

        // Set timeout - 2 seconds
        setTimeout(function () {
            // Remove class
            $(selector_parent).removeClass("copied");
        }, 2000);
    } catch (e) {
        // console.error(e);
    }
}

function delete_search_parameter(name, action) {
    try {
        if ("URLSearchParams" in window) {
            // Vars
            var parameters = new URLSearchParams(window.location.search);

            // Delete search parametereter
            parameters.delete(name);

            // Check if
            if (check_value_defined(parameters.toString())) {
                // Vars
                var new_url = window.location.pathname + "?" + parameters.toString();
            } else {
                // Vars
                var new_url = window.location.pathname;
            }

            // Check if
            if (!get_search_parameter(name) || action == "replace") {
                // Replace history
                history.replaceState("", "", new_url);
            } else if (action == "update") {
                // Update history
                history.pushState("", "", new_url);
            }
        }
    } catch (e) {
        // console.error(e);
    }
}

function format_number_decimals(value) {
    try {
        // Check if
        if ($.isNumeric(value)) {
            // Check if
            if (value >= 1 || value <= -1) {
                // 2 decimals
                value = parseFloat(value).toFixed(2);
            } else {
                // Number zeros after decimal
                var number_zeros = -Math.floor(Math.log10(Math.abs(value)) + 1);

                // Number of decimals = number zeros + 4
                var number_decimals = number_zeros + 4;

                // Check if
                if (number_zeros > 10) {
                    // Vars
                    value = 0;
                } else {
                    // Check if
                    if (number_decimals >= 10) {
                        // Vars
                        number_decimals = 10;
                    }

                    // Format value to number of decimals and trim extra zeros
                    value = parseFloat(parseFloat(value).toFixed(number_decimals));
                }
            }
        } else {
            // Vars
            value = 0;
        }
    } catch (e) {
        // console.error(e);
    }

    // Return
    return value;
}

function format_value_percent(value, percent) {
    // Define vars
    var return_string = "";

    try {
        // Check if
        if ($.isNumeric(value)) {
            // Vars
            value = format_number_decimals(value);
            percent = parseFloat(percent).toFixed(2);

            // Vars
            var change_color = get_change_color(percent);
            var change_direction = get_change_direction(percent);

            // Vars
            return_string = `<span class="font--bold font--${change_color}">${change_direction} $${value} (${percent}%)</span>`;
        }
    } catch (e) {
        // console.error(e);
    }

    // Return
    return return_string;
}

function get_change_color(value) {
    // Define vars
    var change_color = "";

    try {
        // Check if
        if (value > 0) {
            // Vars
            change_color = "green";
        } else if (value < 0) {
            // Vars
            change_color = "red";
        } else {
            // Vars
            change_color = "white";
        }
    } catch (e) {
        // console.error(e);
    }

    // Return
    return change_color;
}

function get_change_direction(value) {
    // Define vars
    var change_direction = "";

    try {
        // Check if
        if (value < 0) {
            // Vars
            change_direction = '<i class="fas fa-long-arrow-alt-down"></i>';
        } else if (value > 0) {
            // Vars
            change_direction = '<i class="fas fa-long-arrow-alt-up"></i>';
        } else {
            // Vars
            change_direction = '';
        }
    } catch (e) {
        // console.error(e);
    }

    // Return
    return change_direction;
}

function get_search_parameter(name) {
    // Define vars
    var parameter = false;

    try {
        // Vars
        var href = window.location.pathname + window.location.search;
        var search_parameters = href.split("?");
        search_parameters = search_parameters[1];

        // Check if
        if ("URLSearchParams" in window) {
            // Search parameters
            var parameters = new URLSearchParams(search_parameters);
            parameter = check_value_defined(parameters.get(name));
        }
    } catch (e) {
        // console.log(e);
    }

    // Return
    return parameter;
}

function init_anchor_tags() {
    try {
        // On click
        $('a[href^="#"]').on("click", function (e) {
            // Vars
            var href = $(this).attr("href");

            // Check if
            if ($(".site__header .header-position-fixed").length > 0) {
                // Vars
                var headerHeight = $("header").innerHeight();
            } else {
                // Vars
                var headerHeight = 0;
            }

            // Animate
            $("html,body").animate({ scrollTop: $(href).offset().top - headerHeight - 100 }, 500);
        });
    } catch (e) {
        // console.log(e);
    }
}

function init_lazy_load() {
    try {
        // Callback
        let callback = (entries, observer) => {
            // Loop
            entries.forEach((entry) => {
                // Check if
                if (entry.intersectionRatio >= 0.1 && entry.target.style.opacity != 1) {
                    // Opacity
                    entry.target.style.opacity = 1;
                }
            });
        };

        // Options
        let options = {
            root: null,
            threshold: [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1]
        }

        // Observer
        let observer = new IntersectionObserver(callback, options);

        // Select .lazy-load
        for (const target of document.querySelectorAll(".lazy-load")) {
            // Observer
            observer.observe(target);
        }
    } catch (e) {
        // console.error(e);
    }
}

function init_popstate() {
    try {
        // On browser popstate
        $(window).on("popstate", function (event) {
            // Load modal from url
            load_modal_from_url();
        });
    } catch (e) {
        // console.error(e);
    }
}

function throttle(callback, limit) {
    try {
        // Vars
        var wait = false;

        // Return
        return function (...args) {
            // Check if
            if (!wait) {
                // Callback
                callback(...args);

                // True
                wait = true;

                // Set timeout
                setTimeout(function () {
                    // False
                    wait = false;
                }, limit);
            }
        }
    } catch (e) {
        // console.error(e);
    }
}

function update_search_parameters(parameters_array, action) {
    try {
        // Check if
        if ("URLSearchParams" in window) {
            // Search parameters
            var parameters = new URLSearchParams(window.location.search);

            // Check if
            if (check_array_defined(parameters_array)) {
                // Loop
                $.each(parameters_array, function (index, value) {
                    // Check if
                    if (value.name && value.value) {
                        // Set parameters
                        parameters.set(value.name, value.value);
                    }
                });

                // New url
                if (check_value_defined(parameters.toString())) {
                    // Vars
                    var new_url = window.location.pathname + "?" + parameters.toString();
                } else {
                    // Vars
                    var new_url = window.location.pathname;
                }

                // Check if
                if (action) {
                    // Update history
                    history.pushState("", "", new_url);
                } else {
                    // Replace history
                    history.replaceState("", "", new_url);
                }
            }
        }
    } catch (e) {
        // console.error(e);
    }
}
function init_accordions() {
    try {
        // Vars
        var selector_accordions = ".accordions";

        // Check if
        if ($(selector_accordions).length > 0) {
            // Vars
            var selector_accordion = selector_accordions + " .accordion";
            var selector_accordion_all = selector_accordions + " [data-accordions-all]";
            var selector_accordion_trigger = selector_accordion + " .trigger";
            var selector_accordions_container = selector_accordions + " .accordions__container";

            // Update accordion selectors
            update_accordion_selectors();

            // Loop
            $(selector_accordions_container + ":not(.accordions--closed)").each(function (index, value) {
                try {
                    // Check if
                    if (!$(this).hasClass("accordions--init")) {
                        // Vars
                        var selector_accordion_first = ".accordion:first-child";

                        // Add class
                        $(this).addClass("accordions--init");

                        // Show first accordion
                        $(this).find(selector_accordion_first).addClass("accordion--open");
                        $(this).find(selector_accordion_first + " .trigger").attr("aria-expanded", true);
                        $(this).find(selector_accordion_first + " .accordion__panel").show();
                    };
                } catch (e) {
                    // console.error(e);
                }
            });

            // On click
            $(selector_accordion_trigger).off("click");
            $(selector_accordion_trigger).on("click", function () {
                try {
                    // Vars
                    var accordion_id = $(this).attr("aria-controls");

                    // Check if
                    if (!check_value_defined(accordion_id)) {
                        // Update accordion selectors
                        update_accordion_selectors();

                        // Vars
                        var accordion_id = $(this).attr("aria-controls");
                    }

                    // Vars
                    var accordion_open = $(this).attr("aria-expanded") === "true";
                    var selector_accordion_id = $(selector_accordion + " #" + accordion_id);

                    // Check if
                    if (accordion_open) {
                        // Close accordion
                        $(this).attr("aria-expanded", false);
                        $(this).closest(".accordion").removeClass("accordion--open");

                        // Slide up
                        $(selector_accordion_id).slideUp(250, function () {
                            // Animation complete.
                        });

                        // Hidden
                        $(selector_accordion_id).attr("hidden", "");
                    } else {
                        // Open accordion
                        $(this).attr("aria-expanded", true);
                        $(this).closest(".accordion").addClass("accordion--open");

                        // Slide down
                        $(selector_accordion_id).slideDown(250, function () {
                            // Animation complete.
                        });

                        // Remove hidden
                        $(selector_accordion_id).removeAttr("hidden");
                    }
                } catch (e) {
                    // console.error(e);
                }
            });

            // On click
            $(selector_accordion_all).off("click");
            $(selector_accordion_all).on("click", function () {
                try {
                    // Vars
                    var accordions_all = $(this).attr("data-accordions-all");
                    var accordions = $(this).closest(selector_accordions).find(".accordion");

                    // Loop
                    $(accordions).each(function (index, value) {
                        // Vars
                        var accordion_id = $(this).find(".trigger").attr("aria-controls");

                        // Check if
                        if (!check_value_defined(accordion_id)) {
                            // Update accordion selectors
                            update_accordion_selectors();

                            // Vars
                            var accordion_id = $(this).attr("aria-controls");
                        }

                        // Check if
                        if (accordions_all == "hide") {
                            // Close accordion by id
                            close_accordion_by_id(accordion_id);
                        } else {
                            // Open accordion by id
                            open_accordion_by_id(accordion_id);
                        }
                    });
                } catch (e) {
                    // console.error(e);
                }
            });
        }
    } catch (e) {
        // console.error(e);
    }
}

function close_accordion_by_id(accordion_id) {
    try {
        // Vars
        var selector_accordions = ".accordions";
        var selector_accordion = selector_accordions + " .accordion";
        var selector_accordion_id = $(selector_accordion + " #" + accordion_id);

        // Close accordion
        $(selector_accordion + " [aria-controls=" + accordion_id + "]").attr("aria-expanded", false);
        $(selector_accordion + " [aria-controls=" + accordion_id + "]").closest(".accordion").removeClass("accordion--open");

        // Hide
        $(selector_accordion_id).hide();

        // Remove hidden
        $(selector_accordion_id).attr("hidden", "");
    } catch (e) {
        // console.error(e);
    }
}

function open_accordion_by_id(accordion_id) {
    try {
        // Vars
        var selector_accordions = ".accordions";
        var selector_accordion = selector_accordions + " .accordion";
        var selector_accordion_id = $(selector_accordion + " #" + accordion_id);

        // Open accordion
        $(selector_accordion + " [aria-controls=" + accordion_id + "]").attr("aria-expanded", true);
        $(selector_accordion + " [aria-controls=" + accordion_id + "]").closest(".accordion").addClass("accordion--open");

        // Show
        $(selector_accordion_id).show();

        // Hidden
        $(selector_accordion_id).removeAttr("hidden");
    } catch (e) {
        // console.error(e);
    }
}

function update_accordion_selectors() {
    try {
        // Loop
        $(".accordions .accordions__container .accordion").each(function (index, value) {
            // Accordion trigger
            $(this).find(".trigger").attr("id", "accordion_id_" + index);
            $(this).find(".trigger").attr("aria-controls", "accordion_panel_" + index);

            // Accordion panel
            $(this).find(".accordion__panel").attr("id", "accordion_panel_" + index);
            $(this).find(".accordion__panel").attr("aria-labelledby", "accordion_id_" + index);
        });
    } catch (e) {
        // console.error(e);
    }
}
function init_charts() {
    try {
        // Init tokenomics chart
        init_tokenomics_chart();
    } catch (e) {
        // console.error(e);
    }
}

function init_tokenomics_chart() {
    try {
        // Vars
        var ctx = document.getElementById("tokenomics_chart").getContext("2d");
        var type = "pie";

        // Data
        var data = {
            labels: [
                "Team",
                "LP"
            ],
            datasets: [{
                label: "Allocation",
                data: [5, 95],
                backgroundColor: [
                    "#ff9900",
                    "#1d1fff"
                ],
                hoverOffset: 4
            }]
        }

        // Init new chart
        new Chart(ctx, {
            type: type,
            data: data
        });
    } catch (e) {
        // console.error(e);
    }
}
// On init, check if message in local storage to display
function init_messages() {
    try {
        // Vars
        var message = check_value_defined(localStorage.message);
        var messages_selector = ".messages";

        // If message, show, then remove
        if (message) {
            messages_popup(message);
            localStorage.removeItem("message");
        }

        // Close messages 
        $(messages_selector + " .close").on("click", function () {
            $(messages_selector).hide();
        });
    } catch (e) {
        // console.error(e);
    }
}

// Popup messages
function messages_popup(message) {
    try {
        if (typeof message !== "undefined" && message !== null && message != "") {
            // Vars
            var message_selector = ".messages [data-name=message]";
            var messages_selector = ".messages";

            // Restart timer
            clearTimeout(app.message_timeout);

            // Check if
            if (!$(message_selector).is(":visible")) {
                // Empty
                $(message_selector).empty();
                $(message_selector).append(message);
            } else {
                $(message_selector).append("<br/>" + message);
            }

            // Fade in
            $(messages_selector).fadeIn();

            // Set 5 second timeout
            app.message_timeout = setTimeout(function () {
                // Fadeout
                $(messages_selector).fadeOut();
            }, 5000);
        }
    } catch (e) {
        // console.error(e);
    }
}

// Form messages
function messages_form(form_name, input_id, message) {
    try {
        // Check if
        if (typeof message == "undefined" || message == null || message == "") {
            message = "";
        }

        // Vars
        var form_selector = "form[name=" + form_name + "] ";

        // Check if
        if (input_id != "") {
            $(form_selector + input_id).removeClass("valid");
            $(form_selector + input_id).addClass("error");
            $(form_selector + "label" + input_id + "-error").removeClass("valid");
            $(form_selector + "label" + input_id + "-error").empty();
            $(form_selector + "label" + input_id + "-error").append(message);
        }
    } catch (e) {
        // console.error(e);
    }
}


// Logic for which message to display
function messages_response(response) {
    try {
        // Suspended
        if (response == "suspended_local_message") {
            // On init pass message
            localStorage.message = app.messages.suspended;
        } else if (response.suspended) {
            messages_popup(app.messages.suspended);
            // Common
            // Permission denied
        } else if (response.permission_denied) {
            messages_popup(app.messages.premission_denied);
            // Correlation
        } else if (response.form_name == "pearson_correlation_form") {
            if (!response.correlation_pearson_string) {
                messages_popup(app.messages.common.correlation.error);
            }
            // Account
            // Account
        } else if (response.form_name == "delete_account_form") {
            if (response.delete_account_subscription) {
                messages_popup(app.messages.account.account.delete_account.subscription);
            } else if (response.delete_account) {
                // On init pass message
                localStorage.message = app.messages.account.account.delete_account.success;

                // Sign out
                submit_sign_out();
            } else {
                messages_popup(app.messages.account.account.delete_account.error);
            }
            // Balance
        } else if (response.form_name == "create_balance_form") {
            if (response.create_balance_already) {
                messages_popup(app.messages.account.balance.create_balance.already);
            } else if (response.create_balance) {
                messages_popup(app.messages.account.balance.create_balance.success);
            } else {
                messages_popup(app.messages.account.balance.create_balance.error);
            }
        } else if (response.form_name == "read_balance_form") {
            if (response.read_balance_settings_error) {
                messages_popup(app.messages.account.balance.read_balance_settings.error);
            }
        } else if (response.form_name == "update_balance_form") {
            if (response.update_balance) {
                messages_popup(app.messages.account.balance.update_balance.success);
            } else {
                messages_popup(app.messages.account.balance.update_balance.error);
            }
        } else if (response.form_name == "update_balance_settings_form") {
            if (response.update_balance_settings) {
                messages_popup(app.messages.account.balance.update_balance_settings.success);
            } else {
                messages_popup(app.messages.account.balance.update_balance_settings.error);
            }
        } else if (response.form_name == "delete_balance_form") {
            if (response.delete_balance) {
                messages_popup(app.messages.account.balance.delete_balance.success);
            } else {
                messages_popup(app.messages.account.balance.delete_balance.error);
            }
        } else if (response.form_name == "delete_balances_form") {
            if (response.delete_balances) {
                messages_popup(app.messages.account.balance.delete_balances.success);
            } else {
                messages_popup(app.messages.account.balance.delete_balances.error);
            }
            // Log in
        } else if (response.form_name == "log_in_form") {
            if (response.login_attempts_reached) {
                messages_popup(app.messages.account.log_in.login_attempts_reached.error);
            } else if (response.logged_in == false) {
                messages_popup(app.messages.account.log_in.error);
            }
            // Profile
        } else if (response.form_name == "forgot_password_form") {
            if (response.forgot_password) {
                messages_popup(app.messages.account.profile.forgot_password.success);
            } else {
                messages_popup(app.messages.account.profile.forgot_password.error);
            }
        } else if (response.form_name == "read_profile_form") {
            if (response.read_profile_error) {
                messages_popup(app.messages.account.profile.read_profile.error);
            }
        } else if (response.form_name == "reset_password_form") {
            if (response.reset_password) {
                messages_popup(app.messages.account.profile.reset_password.success);
            } else {
                messages_popup(app.messages.account.profile.reset_password.error);
            }
        } else if (response.form_name == "update_profile_bio_form") {
            if (response.update_profile_bio) {
                messages_popup(app.messages.account.profile.update_profile_bio.success);
            } else {
                messages_popup(app.messages.account.profile.update_profile_bio.error);
            }
        } else if (response.form_name == "update_profile_cover_image_form") {
            if (response.update_profile_cover_image) {
                messages_popup(app.messages.account.profile.update_profile_cover_image.success);
            } else {
                messages_popup(app.messages.account.profile.update_profile_cover_image.error);
            }
        } else if (response.form_name == "update_profile_email_address_form") {
            if (response.update_profile_email_address == "taken") {
                messages_form(response.form_name, "#profile_email_address", app.messages.account.profile.update_profile_email_address.taken);
            } else if (response.update_profile_email_address) {
                messages_popup(app.messages.account.profile.update_profile_email_address.success);
            } else {
                messages_popup(app.messages.account.profile.update_profile_email_address.error);
            }
        } else if (response.form_name == "resend_verification_email_form") {
            if (response.resend_verification_email == "already") {
                messages_popup(app.messages.verified_email.already);
            } else if (response.mail_sent) {
                messages_popup(app.messages.account.profile.resend_verification_email.success);
            } else {
                messages_popup(app.messages.account.profile.resend_verification_email.error);
            }
        } else if (response.form_name == "update_profile_image_form") {
            if (response.update_profile_image) {
                messages_popup(app.messages.account.profile.update_profile_image.success);
            } else {
                messages_popup(app.messages.account.profile.update_profile_image.error);
            }
        } else if (response.form_name == "update_profile_name_form") {
            if (response.update_profile_name) {
                messages_popup(app.messages.account.profile.update_profile_name.success);
            } else {
                messages_popup(app.messages.account.profile.update_profile_name.error);
            }
        } else if (response.form_name == "update_profile_password_form") {
            if (response.update_profile_password) {
                messages_popup(app.messages.account.profile.update_profile_password.success);
            } else {
                messages_popup(app.messages.account.profile.update_profile_password.error);
            }
        } else if (response.form_name == "update_profile_username_form") {
            if (response.update_profile_username == "taken") {
                messages_form(response.form_name, "#profile_username", app.messages.account.profile.update_profile_username.taken);
            } else if (response.update_profile_username) {
                messages_popup(app.messages.account.profile.update_profile_username.success);
            } else {
                messages_popup(app.messages.account.profile.update_profile_username.error);
            }
        } else if (response.form_name == "update_profile_website_form") {
            if (response.update_profile_website) {
                messages_popup(app.messages.account.profile.update_profile_website.success);
            } else {
                messages_popup(app.messages.account.profile.update_profile_website.error);
            }
            // Settings
        } else if (response.form_name == "read_settings_form") {
            // Read settings
            if (response.read_settings_error) {
                messages_popup(app.messages.account.settings.read_settings.error);
            }
        } else if (response.form_name == "update_settings_general_form") {
            // Update settings general
            if (response.update_settings) {
                messages_popup(app.messages.account.settings.update_settings.success);
            } else {
                messages_popup(app.messages.account.settings.update_settings.error);
            }
        } else if (response.form_name == "update_settings_notifications_form") {
            // Update settings notifications
            if (response.update_settings_notifications) {
                messages_popup(app.messages.account.settings.update_settings_notifications.success);
            } else {
                messages_popup(app.messages.account.settings.update_settings_notifications.error);
            }
        } else if (response.form_name == "update_settings_emails_form") {
            // Update settings emails
            if (response.update_settings_emails) {
                messages_popup(app.messages.account.settings.update_settings_emails.success);
            } else {
                messages_popup(app.messages.account.settings.update_settings_emails.error);
            }
            // Sign up
        } else if (response.form_name == "sign_up_form") {
            if (response.sign_up) {
                messages_popup(app.messages.account.sign_up.success);
            } else {
                messages_popup(app.messages.account.sign_up.error);
            }

            if (response.update_profile_username == "taken") {
                messages_form(response.form_name, "#sign_up_username", app.messages.account.profile.update_profile_username.taken);
            }

            if (response.update_profile_email_address == "taken") {
                messages_form(response.form_name, "#sign_up_email_address", app.messages.account.profile.update_profile_email_address.taken);
            }
            // Verify apple token
        } else if (response.form_name == "verify_token_apple_form") {
            messages_popup(app.messages.account.verify_token_apple.error);
            // Verify google token
        } else if (response.form_name == "verify_token_google_form") {
            messages_popup(app.messages.account.verify_token_google.error);
            // Dashboard
            // _Common
        } else if (response.form_name == "update_table_filters_form") {
            if (response.update_table_filters) {
                messages_popup(app.messages.dashboard._common.table_filters.update_table_filters_success);
            } else if (response.reset_table_filters) {
                messages_popup(app.messages.dashboard._common.table_filters.reset_table_filters_success);
            } else {
                messages_popup(app.messages.dashboard._common.table_filters.error);
            }
        } else if (response.form_name == "update_heatmap_filters_form") {
            if (response.update_heatmap_filters) {
                messages_popup(app.messages.dashboard._common.heatmap_filters.update_heatmap_filters_success);
            } else if (response.reset_heatmap_filters) {
                messages_popup(app.messages.dashboard._common.heatmap_filters.reset_heatmap_filters_success);
            } else {
                messages_popup(app.messages.dashboard._common.heatmap_filters.error);
            }
        } else if (response.form_name == "update_table_settings_form") {
            if (response.update_table_settings) {
                messages_popup(app.messages.dashboard._common.table_settings.update_table_settings_success);
            } else if (response.reset_table_settings) {
                messages_popup(app.messages.dashboard._common.table_settings.reset_table_settings_success);
            } else {
                messages_popup(app.messages.dashboard._common.table_settings.error);
            }
        } else if (response.form_name == "update_heatmap_settings_form") {
            if (response.update_heatmap_settings) {
                messages_popup(app.messages.dashboard._common.heatmap_settings.update_heatmap_settings_success);
            } else if (response.reset_heatmap_settings) {
                messages_popup(app.messages.dashboard._common.heatmap_settings.reset_heatmap_settings_success);
            } else {
                messages_popup(app.messages.dashboard._common.heatmap_settings.error);
            }
        // Home
    }    else if (response.form_name == "read_home_form") {
            if (!response.home_found) {
                messages_popup(app.messages.dashboard.home.not_found);
            }
            // News
        } else if (response.form_name == "update_news_filters_form") {
            if (response.update_news_filters) {
                messages_popup(app.messages.dashboard.news.news_filters.update_news_filters_success);
            } else if (response.reset_news_filters) {
                messages_popup(app.messages.dashboard.news.news_filters.reset_news_filters_success);
            } else {
                messages_popup(app.messages.dashboard.news.news_filters.error);
            }
        } else if (response.form_name == "update_news_settings_form") {
            if (response.update_news_settings) {
                messages_popup(app.messages.dashboard.news.news_settings.update_news_settings_success);
            } else if (response.reset_news_settings) {
                messages_popup(app.messages.dashboard.news.news_settings.reset_news_settings_success);
            } else {
                messages_popup(app.messages.dashboard.news.news_settings.error);
            }
            // Plays
        } else if (response.form_name == "close_play_form") {
            if (response.close_play) {
                messages_popup(app.messages.dashboard.plays.close_play.success);
            } else if (response.close_play_market_closed) {
                messages_popup(app.messages.dashboard.plays.close_play.market_closed);
            } else {
                messages_popup(app.messages.dashboard.plays.close_play.error);
            }
        } else if (response.form_name == "create_play_form") {
            if (response.create_play) {
                messages_popup(app.messages.dashboard.plays.create_play.success);
            } else if (response.create_play_open_already) {
                messages_popup(app.messages.dashboard.plays.create_play.already);
            } else if (response.create_play_closed_past) {
                messages_popup(app.messages.dashboard.plays.create_play.closed_past);
            } else if (response.create_play_limit) {
                messages_popup(app.messages.dashboard.plays.create_play.limit);
            } else if (response.create_play_limit_basic) {
                messages_popup(app.messages.dashboard.plays.create_play.limit_basic);
            } else if (response.create_play_price) {
                messages_popup(app.messages.dashboard.plays.create_play.price);
            } else if (response.create_play_market_closed) {
                messages_popup(app.messages.dashboard.plays.create_play.market_closed);
            } else {
                messages_popup(app.messages.dashboard.plays.create_play.error);
            }
        } else if (response.form_name == "delete_plays_form") {
            if (response.delete_plays) {
                messages_popup(app.messages.dashboard.plays.delete_plays.success);
            } else {
                messages_popup(app.messages.dashboard.plays.delete_plays.error);
            }
        } else if (response.form_name == "delete_plays_watchlist_symbol_form") {
            if (response.delete_plays_watchlist_symbol) {
                messages_popup(app.messages.dashboard.plays.delete_plays_watchlist_symbol.success);
            } else {
                messages_popup(app.messages.dashboard.plays.delete_plays_watchlist_symbol.error);
            }
        } else if (response.form_name == "create_plays_watchlist_symbol_form") {
            if (response.create_plays_watchlist_symbol) {
                messages_popup(app.messages.dashboard.plays.create_plays_watchlist_symbol.success);
            } else if (response.create_plays_watchlist_limit_basic) {
                messages_popup(app.messages.dashboard.plays.create_plays_watchlist_symbol.limit_basic);
            } else if (response.create_plays_watchlist_limit) {
                messages_popup(app.messages.dashboard.plays.create_plays_watchlist_symbol.limit);
            } else {
                messages_popup(app.messages.dashboard.plays.create_plays_watchlist_symbol.error);
            }
            // Alerts
        } else if (response.form_name == "delete_alerts_watchlist_symbol_form") {
            if (response.delete_alerts_watchlist_symbol) {
                messages_popup(app.messages.dashboard.alerts.delete_alerts_watchlist_symbol.success);
            } else {
                messages_popup(app.messages.dashboard.alerts.delete_alerts_watchlist_symbol.error);
            }
        } else if (response.form_name == "create_alerts_watchlist_symbol_form") {
            if (response.create_alerts_watchlist_symbol) {
                messages_popup(app.messages.dashboard.alerts.create_alerts_watchlist_symbol.success);
            } else if (response.create_alerts_watchlist_limit) {
                messages_popup(app.messages.dashboard.alerts.create_alerts_watchlist_symbol.limit);
            } else {
                messages_popup(app.messages.dashboard.alerts.create_alerts_watchlist_symbol.error);
            }
        } else if (response.form_name == "read_alerts_statistics_form") {
            if (response.alerts_statistics_not_found) {
                messages_popup(app.messages.dashboard.alerts.statistics.not_found);
            } else if (!response.alerts_statistics_chart) {
                messages_popup(app.messages.dashboard.alerts.statistics.error);
            }
            // Symbols
            // Watchlist
        } else if (response.form_name == "create_symbols_watchlist_symbol_form") {
            if (response.create_symbols_watchlist_symbol) {
                messages_popup(app.messages.dashboard.watchlist.create_symbols_watchlist_symbol.success);
            } else if (response.create_symbols_watchlist_symbol_limit_basic) {
                messages_popup(app.messages.dashboard.watchlist.create_symbols_watchlist_symbol.limit_basic);
            } else if (response.create_symbols_watchlist_symbol_limit) {
                messages_popup(app.messages.dashboard.watchlist.create_symbols_watchlist_symbol.limit);
            } else {
                messages_popup(app.messages.dashboard.watchlist.create_symbols_watchlist_symbol.error);
            }
        } else if (response.form_name == "delete_watchlist_symbol_form") {
            if (response.delete_symbols_watchlist_symbol) {
                messages_popup(app.messages.dashboard.watchlist.delete_symbols_watchlist_symbol.success);
            } else {
                messages_popup(app.messages.dashboard.watchlist.delete_symbols_watchlist_symbol.error);
            }
            // Notify
        } else if (response.form_name == "create_symbols_watchlist_notify_symbol_form") {
            if (response.create_symbols_watchlist_notify_symbol == "watchlist") {
                messages_popup(app.messages.dashboard.watchlist.create_symbols_watchlist_notify_symbol.watchlist);
            } else if (response.create_symbols_watchlist_notify_symbol) {
                messages_popup(app.messages.dashboard.watchlist.create_symbols_watchlist_notify_symbol.success);
            } else {
                messages_popup(app.messages.dashboard.watchlist.create_symbols_watchlist_notify_symbol.error);
            }
        } else if (response.form_name == "delete_symbols_watchlist_notify_symbol_form") {
            if (response.delete_symbols_watchlist_notify_symbol) {
                messages_popup(app.messages.dashboard.watchlist.delete_symbols_watchlist_notify_symbol.success);
            } else {
                messages_popup(app.messages.dashboard.watchlist.delete_symbols_watchlist_notify_symbol.error);
            }
            // News
        } else if (response.form_name == "read_news_form") {
            if (!response.news_found) {
                // On init pass message
                localStorage.message = app.messages.news.not_found;
            }
            // Help
            // Contact
        } else if (response.form_name == "contact_form") {
            if (response.mail_sent) {
                messages_popup(app.messages.help.contact.success);

                // Reset contact form
                $("form[name=contact_form] [name=subject]").val("select").change();
                $("form[name=contact_form] [name=message]").val('');
            } else {
                messages_popup(app.messages.help.contact.error);
            }
            // Notifications
        } else if (response.form_name == "delete_notifications_form") {
            if (response.delete_notifications) {
                messages_popup(app.messages.notifications.delete_notifications.success);
            } else {
                messages_popup(app.messages.notifications.delete_notifications.error);
            }
        } else if (response.form_name == "delete_notification_form") {
            if (response.delete_notification) {
                messages_popup(app.messages.notifications.delete_notification.success);
            } else {
                messages_popup(app.messages.notifications.delete_notification.error);
            }
            // Symbol
        } else if (response.form_name == "update_symbol_chart_settings_form") {
            if (response.update_symbol_chart_settings) {
                messages_popup(app.messages.symbol.symbol_chart_settings.update_symbol_chart_settings_success);
            } else if (response.reset_symbol_chart_settings) {
                messages_popup(app.messages.symbol.symbol_chart_settings.reset_symbol_chart_settings_success);
            } else {
                messages_popup(app.messages.symbol.symbol_chart_settings.error);
            }
            // Updates
        } else if (response.form_name == "read_updates_form") {
            if (!response.updates_found) {
                messages_popup(app.messages.updates.read_updates.not_found);
            }
            // User
            // Blocked
        } else if (response.form_name == "create_user_blocked_form") {
            if (response.create_user_blocked) {
                messages_popup(app.messages.user.create_user_blocked.success.replace("@username", app.user_username_message));
            } else {
                messages_popup(app.messages.user.create_user_blocked.error.replace("@username", app.user_username_message));
            }
            // Follow
        } else if (response.form_name == "create_user_follow_form") {
            if (response.user_blocked) {
                messages_popup(app.messages.user.blocked.replace("@username", app.user_username_message));
            } else if (response.user_private_mode) {
                messages_popup(app.messages.user.private_mode.replace("@username", app.user_username_message));
            } else if (response.create_user_follow == "muted") {
                messages_popup(app.messages.user.create_user_follow.muted.replace("@username", app.user_username_message));
            } else if (response.create_user_follow) {
                messages_popup(app.messages.user.create_user_follow.success.replace("@username", app.user_username_message));
            } else {
                messages_popup(app.messages.user.create_user_follow.error.replace("@username", app.user_username_message));
            }
            // Muted
        } else if (response.form_name == "create_user_muted_form") {
            if (response.create_user_muted) {
                messages_popup(app.messages.user.create_user_muted.success.replace("@username", app.user_username_message));
            } else {
                messages_popup(app.messages.user.create_user_muted.error.replace("@username", app.user_username_message));
            }
            // Notify
        } else if (response.form_name == "create_user_notify_form") {
            if (response.create_user_notify == "follow") {
                messages_popup(app.messages.user.create_user_notify.follow.replace("@username", app.user_username_message));
            } else if (response.create_user_notify == "muted") {
                messages_popup(app.messages.user.create_user_notify.muted.replace("@username", app.user_username_message));
            } else if (response.create_user_notify) {
                messages_popup(app.messages.user.create_user_notify.success.replace("@username", app.user_username_message));
            } else {
                messages_popup(app.messages.user.create_user_notify.error.replace("@username", app.user_username_message));
            }
            // Reported
        } else if (response.form_name == "create_user_reported_form") {
            if (response.create_user_reported_already) {
                messages_popup(app.messages.user.create_user_reported.already.replace("@username", app.user_username_message));
            } else if (response.create_user_reported) {
                messages_popup(app.messages.user.create_user_reported.success.replace("@username", app.user_username_message));
            } else {
                messages_popup(app.messages.user.create_user_reported.error.replace("@username", app.user_username_message));
            }
            // Blocked
        } else if (response.form_name == "delete_user_blocked_form") {
            if (response.delete_user_blocked) {
                messages_popup(app.messages.user.delete_user_blocked.success.replace("@username", app.user_username_message));
            } else {
                messages_popup(app.messages.user.delete_user_blocked.error.replace("@username", app.user_username_message));
            }
            // Follow
        } else if (response.form_name == "delete_user_follow_form") {
            if (response.delete_user_follow) {
                messages_popup(app.messages.user.delete_user_follow.success.replace("@username", app.user_username_message));
            } else {
                messages_popup(app.messages.user.delete_user_follow.error.replace("@username", app.user_username_message));
            }
            // Follower
        } else if (response.form_name == "delete_user_follower_form") {
            if (response.delete_user_follower) {
                messages_popup(app.messages.user.delete_user_follower.success.replace("@username", app.user_username_message));
            } else {
                messages_popup(app.messages.user.delete_user_follower.error.replace("@username", app.user_username_message));
            }
            // Muted
        } else if (response.form_name == "delete_user_muted_form") {
            if (response.delete_user_muted) {
                messages_popup(app.messages.user.delete_user_muted.success.replace("@username", app.user_username_message));
            } else {
                messages_popup(app.messages.user.delete_user_muted.error.replace("@username", app.user_username_message));
            }
            // Notify
        } else if (response.form_name == "delete_user_notify_form") {
            if (response.delete_user_notify) {
                messages_popup(app.messages.user.delete_user_notify.success.replace("@username", app.user_username_message));
            } else {
                messages_popup(app.messages.user.delete_user_notify.error.replace("@username", app.user_username_message));
            }
        } else if (response.form_name == "read_user_form") {
            if (response.user_private_mode) {
                messages_popup(app.messages.user.private_mode.replace("@username", app.user_username));
            } else if (!response.user_found) {
                // On init pass message
                localStorage.message = app.messages.user.not_found.replace("@username", app.user_username);
            }
        } else if (response.form_name == "read_user_plays_statistics_form") {
            if (response.user_plays_statistics_not_found) {
                messages_popup(app.messages.user.statistics.not_found);
            } else if (!response.user_plays_statistics_chart) {
                messages_popup(app.messages.user.statistics.error);
            }
        }
    } catch (e) {
        // console.error(e);
    }
}
function init_modals() {
    try {
        // Vars
        var modal = ".modal";
        
        // Load modal from url
        load_modal_from_url();

        // On click
        $("[data-modal-button]").off("click");
        $("[data-modal-button]").on("click", function () {
            // Vars
            var data_modal = $(this).attr("data-modal-button");

            // Show modal
            show_modal(data_modal, true);
        });

        // On click
        $(modal + ".modal__background, " + modal + " .close, " + modal + " .close-button").off("click");
        $(modal + " .modal__background, " + modal + " .close, " + modal + " .close-button").on("click", function () {
            // Hide modal
            hide_modal("", "update");
        });
    } catch (e) {
        // console.log(e);
    }
}

function load_modal_from_url() {
    try {
        // Get search parameter
        var data_modal = get_search_parameter("modal");

        // If modal 
        if (data_modal) {
            // Show modal
            show_modal(data_modal, false);
        } else {
            // Hide modal
            hide_modal("", "replace");
        }
    } catch (e) {
        // console.error(e);
    }
}

function show_modal(data_modal, update_history) {
    try {
        // Define vars
        var modal_selector = ".modal";

        // Check if
        if ($(".modal:visible").length > 0) {
            // Hide modal
            $(modal_selector).hide();

            // Show modal
            $("[data-modal=" + data_modal + "]").show();
        }else{
            // Show modal
            $("[data-modal=" + data_modal + "]").fadeIn(250);
        }

        // Show
        $("[data-modal=" + data_modal + "]").css("display", "flex");

        // Add modal content transform
        $(".modal__content").addClass("modal__content-transform");

        // Add disable scroll
        $("body").addClass("disable-scroll");

        // Vars
        var parameters_array = [
            {
                name: "modal",
                value: data_modal,
            }
        ];

        // Check if
        if (update_history) {
            // Update search parameters
            update_search_parameters(parameters_array, true);
        }
    } catch (e) {
        // console.error(e);
    }
}

function hide_modal(data_modal, action) {
    try {
        // If modal selector
        if (!data_modal) {
            // Vars
            data_modal = $(".modal:visible").attr("data-modal");
        }

        // Check if
        if ($(".modal:visible").length > 0) {
            // Hide modal
            $(".modal").fadeOut(50);
        }

        // Remove modal content transform
        $(".modal__content").removeClass("modal__content-transform");

        // Remove disable scroll
        $("body").removeClass("disable-scroll");

        // Check if
        if (data_modal) {
            // Delete search parameter
            delete_search_parameter("modal", action);
        }
    } catch (e) {
        // console.error(e);
    }
}
function init_number_counters() {
    try {
        // Init number counter
        init_number_counter();

        // On scroll
        $(window).on("scroll", function () {
            // Init number counters
            init_number_counter();
        });
    } catch (e) {
        // console.log(e);
    }
}

function animate_count_value(this_text, count_value) {
    try {
        // Animate count
        $({ countNum: this_text.text() }).animate({
            countNum: count_value
        },
            {
                duration: 2500,
                easing: "swing",
                step: function () {
                    this_text.text(Math.floor(this.countNum));
                },
                complete: function () {
                    // Check if
                    if ($(this_text).closest("[data-number]").attr("data-comma") != "Yes") {
                        // Commas
                        this_text.text(numberWithCommas(this.countNum));
                    } else {
                        // No commas
                        this_text.text(this.countNum);
                    }

                    // Update swiper
                    poncho_json.home_swiper.update();
                },
            });
    } catch (e) {
        // console.log(e);
    }
}

function format_counter_value(count_value) {
    // Vars
    var count_value_format = "";

    try {
        // Check if ratio :
        if (count_value.indexOf(":") > -1) {
            // Vars
            var count_values = count_value.split(":");
            var count_value_1 = count_values[0];
            var count_value_2 = count_values[1];

            // New count value
            count_value_format = `<span data-number-format=${count_value_1}></span>:<span data-number-format=${count_value_2}></span>`;
        } else {
            // Format large number and decimals
            count_value_format = format_large_number(count_value);
        }
    } catch (e) {
        // console.log(e);
    }

    // Return
    return count_value_format;
}

function format_large_number(count_value) {
    // Define vars
    var count_value_format = "";
    var letter = "";

    try {
        // Vars
        count_value = Number(count_value);

        // Check value
        if ($.isNumeric(count_value)) {
            // Format number
            if (count_value > 1000000000000 || count_value < -1000000000000) {
                // Trillion
                count_value = (count_value / 1000000000000).toFixed(1);
                letter = "T";
            } else if (count_value > 1000000000 || count_value < -1000000000) {
                // Billion
                count_value = (count_value / 1000000000).toFixed(1);
                letter = "B";
            } else if (count_value > 1000000 || count_value < -1000000) {
                // Million
                count_value = (count_value / 1000000).toFixed(1);
                letter = "M";
            } else if (count_value > 10000 || count_value < -10000) {
                // Thousand
                count_value = (count_value / 1000).toFixed(1);
                letter = "K";
            } else {
                // Round
                count_value = count_value.toFixed(1);
            }
        }

        // Check if decimal .
        if (count_value.indexOf(".") > -1) {
            // Vars
            var count_values = count_value.split(".");
            var count_value_1 = count_values[0];
            var count_value_2 = count_values[1];

            // Check if
            if (count_value_2 == 0 || count_value_2 == "" || typeof count_value_2 == "undefined" || count_value_2 == null) {
                // New count value
                count_value_format = `<span data-number-format=${count_value_1}></span>${letter}`;
            } else {
                // New count value
                count_value_format = `<span data-number-format=${count_value_1}></span>.<span data-number-format=${count_value_2}></span>${letter}`;
            }
        } else {
            // New count value
            count_value_format = `<span data-number-format=${count_value}></span>${letter}`;
        }
    } catch (e) {
        // console.log(e);
    }

    // Return
    return count_value_format;
}

function init_number_counter() {
    try {
        // Loop
        $(".number-counter.count").each(function () {
            // Vars
            var offset_top = $(this).offset().top - window.innerHeight + 100;

            // Check if counter in view
            if ($(window).scrollTop() > offset_top) {
                // Remove count class 
                $(this).removeClass("count");

                // Loop each counter value to format
                $($(this).find(".value [data-number]")).each(function () {
                    // Vars
                    var count_value = $(this).attr("data-number");

                    // Format counter value
                    count_value_format = format_counter_value(count_value);

                    // Append formatted counter value
                    $(this).empty().append(count_value_format);
                });

                // Loop each counter value to animate
                $($(this).find(".value [data-number-format]")).each(function () {
                    // Var
                    var this_text = $(this);
                    var count_value = $(this).attr("data-number-format");

                    // Animate count
                    animate_count_value(this_text, count_value);
                });
            }
        });
    } catch (e) {
        // console.log(e);
    }
}

function numberWithCommas(x) {
    try {
        // Commas
        return x.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",");
    } catch (e) {
        // console.log(e);
    }
}
function init_particles() {
    try {
        // Particle JS
        particlesJS("particles", { "particles": { "number": { "value": 150, "density": { "enable": true, "value_area": 1000 } }, "color": { "value": "#ffffff" }, "shape": { "type": "circle", "stroke": { "width": 0, "color": "#000000" }, "polygon": { "nb_sides": 5 }, "image": { "src": "img/github.svg", "width": 100, "height": 100 } }, "opacity": { "value": 1, "random": true, "anim": { "enable": true, "speed": 1, "opacity_min": 0, "sync": false } }, "size": { "value": 6, "random": true, "anim": { "enable": false, "speed": 4, "size_min": 0.3, "sync": false } }, "line_linked": { "enable": false, "distance": 150, "color": "#ffffff", "opacity": 0.4, "width": 1 }, "move": { "enable": true, "speed": 1, "direction": "none", "random": true, "straight": false, "out_mode": "out", "bounce": false, "attract": { "enable": false, "rotateX": 600, "rotateY": 600 } } }, "interactivity": { "detect_on": "canvas", "events": { "onhover": { "enable": true, "mode": "bubble" }, "onclick": { "enable": true, "mode": "repulse" }, "resize": true }, "modes": { "grab": { "distance": 400, "line_linked": { "opacity": 1 } }, "bubble": { "distance": 250, "size": 0, "duration": 2, "opacity": 0, "speed": 3 }, "repulse": { "distance": 400, "duration": 0.4 }, "push": { "particles_nb": 4 }, "remove": { "particles_nb": 2 } } }, "retina_detect": true }); var count_particles, stats, update; stats = new Stats; stats.setMode(0); stats.domElement.style.position = 'absolute'; stats.domElement.style.left = '0px'; stats.domElement.style.top = '0px'; document.body.appendChild(stats.domElement); count_particles = document.querySelector('.js-count-particles'); update = function () { stats.begin(); stats.end(); if (window.pJSDom[0].pJS.particles && window.pJSDom[0].pJS.particles.array) { count_particles.innerText = window.pJSDom[0].pJS.particles.array.length; } requestAnimationFrame(update); }; requestAnimationFrame(update);;
    } catch (e) {
        // console.error(e);
    }
}

function init_scroll() {
    try {
        // Vars
        var scroll_selector_class = ".scroll-top";
        var scroll_selector_id = "#scroll-top";
        var scroll_timeout = "";

        // On scroll
        $(window).on("scroll", throttle(function (event) {
            try {
                // Vars
                var scroll_top = $(this).scrollTop();
                var window_height = window.innerHeight;
                window_height = window_height * 1;

                // Check if
                if (scroll_top > window_height) {
                    // Fade in
                    $(scroll_selector_class).fadeIn(100);

                    // Clear timeout
                    clearTimeout(scroll_timeout)

                    // Set timeout
                    scroll_timeout = setTimeout(function () {
                        // Fade out
                        $(scroll_selector_class).fadeOut(100);
                    }, 2000);
                } else {
                    // Fade out
                    $(scroll_selector_class).fadeOut(100);
                }
            } catch (e) {
                // console.error(e);
            }
        }, 100));

        // On click
        $(scroll_selector_id).off("click");
        $(scroll_selector_id).on("click", function () {
            try {
                // Animate
                $("html, body").animate({ scrollTop: 0 }, 500);

                // Return
                return false;
            } catch (e) {
                // console.error(e);
            }
        });
    } catch (e) {
        // console.error(e);
    }
}
function init_swipers() {
    try {
        // Init about swiper
        init_about_swiper();

        // Init home swiper
        init_home_swiper();

        // Init roadmap swiper
        init_roadmap_swiper();
    } catch (e) {
        // console.error(e);
    }
}

function init_about_swiper() {
    try {
        // Define vars
        var selector_swiper = ".about-swiper";
        var data_swiper = "[data-swiper=about-swiper]";

        // Init new swiper
        new Swiper(data_swiper, {
            // Optional parameters
            direction: "horizontal",
            keyboard: {
                enabled: true,
                onlyInViewport: false,
            },
            mousewheel: {
                forceToAxis: true
            },
            navigation: {
                nextEl: selector_swiper + " .swiper-next",
                prevEl: selector_swiper + " .swiper-prev"
            },
            slidesPerView: "auto",
            slidesPerGroup: 1,
            speed: 600,
            updateOnWindowResize: true
        });
    } catch (e) {
        // console.error(e);
    }
}

function init_home_swiper() {
    try {
        // Define vars
        var selector_swiper = ".home-swiper";
        var data_swiper = "[data-swiper=home-swiper]";

        // Init new swiper
        poncho_json.home_swiper = new Swiper(data_swiper, {
            // Optional parameters
            direction: "horizontal",
            keyboard: {
                enabled: true,
                onlyInViewport: false,
            },
            mousewheel: {
                forceToAxis: true
            },
            navigation: {
                nextEl: selector_swiper + " .swiper-next",
                prevEl: selector_swiper + " .swiper-prev"
            },
            slidesPerView: "auto",
            slidesPerGroup: 1,
            updateOnWindowResize: true
        });
    } catch (e) {
        // console.error(e);
    }
}

function init_roadmap_swiper() {
    try {
        // Define vars
        var selector_swiper = ".roadmap-swiper";
        var data_swiper = "[data-swiper=roadmap-swiper]";

        // Init new swiper
        new Swiper(data_swiper, {
            // Optional parameters
            centeredSlides: true,
            centeredSlidesBounds: true,
            direction: "horizontal",
            keyboard: {
                enabled: true,
                onlyInViewport: false,
            },
            mousewheel: {
                forceToAxis: true
            },
            navigation: {
                nextEl: selector_swiper + " .swiper-next",
                prevEl: selector_swiper + " .swiper-prev"
            },
            slidesPerView: "auto",
            slidesPerGroup: 1,
            updateOnWindowResize: true
        });
    } catch (e) {
        // console.error(e);
    }
}
function read_token(initialize) {
    try {
        // Define vars
        var pair_found = false;

        // Read token
        $.ajax({
            type: "GET",
            cache: false,
            url: "https://api.dexscreener.com/latest/dex/pairs/base/0x6FD34677ecDFae4caE732A5B22F1A3082917eb15",
            success: function (response, status, xhr) {
                // Vars
                response = check_value_defined(response);
                var pair = check_value_defined(response.pair);

                // Update token ui
                pair_found = update_token_ui(initialize, pair);
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                // console.error(errorThrown);
            }
        }).always(() => {
            // nprogress_end();
            // Check if
            if (!pair_found) {
                // Read token backup
                read_token_backup(initialize);
            }
        });
    } catch (e) {
        // console.error(e);
    }
}

function read_token_backup(initialize) {
    try {
        // Read token
        $.ajax({
            type: "GET",
            cache: false,
            url: "https://api.dexscreener.com/latest/dex/tokens/0xc2fe011c3885277c7f0e7ffd45ff90cadc8ecd12",
            success: function (response, status, xhr) {
                // Vars
                response = check_value_defined(response);
                var pairs = check_array_defined(response.pairs);

                // Check if
                if (pairs) {
                    // Loop
                    $.each(pairs, function (index, value) {
                        // Vars
                        var address = check_value_defined(value.baseToken.address);
                        var symbol = check_value_defined(value.baseToken.symbol);
                        var chain_id = check_value_defined(value.chainId);

                        // Check if
                        if (
                            address == "0xC2fE011C3885277c7F0e7ffd45Ff90cADc8ECD12" &&
                            symbol == "PONCHO" &&
                            chain_id == "base"
                        ) {
                            // Update token ui
                            update_token_ui(initialize, value);

                            // Return
                            return false;
                        }
                    });
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                // console.error(errorThrown);
            }
        }).always(() => {
            // nprogress_end();
        });
    } catch (e) {
        // console.error(e);
    }
}

function set_read_token_interval() {
    try {
        // Set interval - 1 min
        setInterval(function () {
            // Read token
            read_token(false);
        }, 60 * 1000);
    } catch (e) {
        // console.error(e);
    }
}

function update_token_ui(initialize, pair) {
    // Define vars
    var pair_found = false;

    try {
        // Check if
        if (pair) {
            // Vars
            var price = check_value_defined(pair.priceUsd);

            // Check if
            if (price) {
                // Vars
                var price_change = check_value_defined(pair.priceChange.h24);
                var price_string = format_value_percent(price, price_change);
                var market_cap = check_value_defined(pair.marketCap);
                var volume = check_value_defined(pair.volume.h24);
                var buys = check_value_defined(pair.txns.h24.buys);
                var sells = check_value_defined(pair.txns.h24.sells);
                var transactions = buys + sells;
                var liquidity = check_value_defined(pair.liquidity.usd);

                // Check if
                if (price_string) {
                    // Append
                    $("[data-token=price]").html(price_string);

                    // Market cap
                    $("[data-token=market_cap]").attr("data-number", market_cap);
                    $("[data-token=market_cap]").closest(".number-counter").addClass("count");

                    // Volume
                    $("[data-token=volume]").attr("data-number", volume);
                    $("[data-token=volume]").closest(".number-counter").addClass("count");

                    // Transactions
                    $("[data-token=transactions]").attr("data-number", transactions);
                    $("[data-token=transactions]").closest(".number-counter").addClass("count");

                    // Liquidity
                    $("[data-token=liquidity]").attr("data-number", liquidity);
                    $("[data-token=liquidity]").closest(".number-counter").addClass("count");

                    // Init number counters
                    init_number_counters();

                    // Update swiper
                    poncho_json.home_swiper.update();

                    // Vars
                    pair_found = true;

                    // Check if
                    if (initialize) {
                        // Set timeout
                        setTimeout(function () {
                            // Title
                            document.title = "$PONCHO: " + price + " (" + price_change + "%) | Poncho on BASE";
                        }, 5000);
                    } else {
                        // Title
                        document.title = "$PONCHO: " + price + " (" + price_change + "%) | Poncho on BASE";
                    }
                }
            }
        }


    } catch (e) {
        // console.error(e);
    }

    // Return
    return pair_found;
}
function init_meme_generator() {
    try {
        // Vars
        var canvas = document.getElementById("meme_canvas");
        var selector_modal_memes = "[data-modal=memes]";
        var selector_meme_generator = selector_modal_memes + " .meme_generator";

        // Create meme
        create_meme();

        // On click - reset
        $(selector_meme_generator + " .reset").off("click");
        $(selector_meme_generator + " .reset").on("click", function () {
            try {
                // Create meme
                create_meme();
            } catch (e) {
                // console.error(e);
            }
        });

        // On click - save
        $(selector_meme_generator + " .edit").off("click");
        $(selector_meme_generator + " .edit").on("click", function () {
            try {
                // Clear
                $(selector_meme_generator + " .meme img").remove();
            } catch (e) {
                // console.error(e);
            }
        });

        // On click - save
        $(selector_meme_generator + " .save").off("click");
        $(selector_meme_generator + " .save").on("click", function () {
            try {
                // Clear
                $(selector_meme_generator + " .meme img").remove();

                // New image
                var image = new Image();

                // Image source
                image.src = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");

                // Append
                $(selector_meme_generator + " .meme").append(image);
            } catch (e) {
                // console.error(e);
            }
        });

        // On click - download
        $(selector_meme_generator + " .download").off("click");
        $(selector_meme_generator + " .download").on("click", function () {
            try {
                canvas.toBlob((blob) => {
                    const newImg = document.createElement("img");
                    const url = URL.createObjectURL(blob);

                    newImg.onload = () => {
                        // no longer need to read the blob so it's revoked
                        URL.revokeObjectURL(url);
                    };



                    // Create link
                    var link = document.createElement("a");
                    link.href = url;
                    link.download = "poncho_meme.png";

                    // Click
                    link.click();
                    link.remove();
                });

                // // New image
                // var image = new Image();

                // // Image source
                // image.src = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");

                // // Create link
                // var link = document.createElement("a");
                // link.href = image.src;
                // link.download = "poncho_meme.png";

                // // Click
                // link.click();
                // link.remove();


                // var link = document.createElement("a");
                // link.download = "image.png";

                // canvas.toBlob(function (blob) {
                //     link.href = URL.createObjectURL(blob);
                // }, 'image/png');

                // link.click();
            } catch (e) {
                // console.error(e);
            }
        });

        // On click - expand
        $(selector_meme_generator + " .expand").off("click");
        $(selector_meme_generator + " .expand").on("click", function () {
            try {
                // Hide
                $(this).hide();

                // Show
                $(selector_meme_generator + " .compress").show();

                // Remove class
                $(selector_meme_generator).removeClass("compress");

                // Add class
                $(selector_meme_generator).addClass("expand");
            } catch (e) {
                // console.error(e);
            }
        });

        // On click - compress
        $(selector_meme_generator + " .compress").off("click");
        $(selector_meme_generator + " .compress").on("click", function () {
            try {
                // Hide
                $(this).hide();

                // Show
                $(selector_meme_generator + " .expand").show();

                // Remove class
                $(selector_meme_generator).removeClass("expand");

                // Add class
                $(selector_meme_generator).addClass("compress");
            } catch (e) {
                // console.error(e);
            }
        });
    } catch (e) {
        // console.error(e);
    }
}

function create_meme() {
    try {
        // Vars
        var selector_modal_memes = "[data-modal=memes]";
        var selector_meme_generator = selector_modal_memes + " .meme_generator";

        // Clear
        $(selector_meme_generator + " .meme img").remove();

        try {
            // Destroy fabric
            poncho_json.meme_canvas.dispose();
            poncho_json.meme_canvas = "";
        } catch (e) {
            // console.error(e);
        }

        // New fabric canvas
        poncho_json.meme_canvas = new fabric.Canvas("meme_canvas");

        // Add image to canvas
        fabric.Image.fromURL("/dist/img/memes/templates/poncho_template.png?v=2").then((image) => {
            // Set fabric dimensions to match image
            poncho_json.meme_canvas.setHeight(image.width);
            poncho_json.meme_canvas.setWidth(image.height);

            // Set attributes
            image.set({
                hasControls: false,
                hoverCursor: "auto",
                selectable: false
            });

            // Add image
            poncho_json.meme_canvas.add(image);

            // Add text
            poncho_json.meme_canvas.add(new fabric.IText("Type Here", {
                fontFamily: "Delicious_500",
                left: 100,
                textAlign: "left",
                top: 100
            }));

            // Set

        });
    } catch (e) {
        // console.error(e);
    }
}